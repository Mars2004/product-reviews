# Test Product Reviews Project

## Description

This is test project which is part of job interview. Not all edge cases are covered and some error handling might be better.

## Task Assignment

Your task is to build a two service system for product reviews.

Product service will expose RESTful API interfaces for manipulation with
products and reviews.

Review processing service will handle calculation of average review product
rating.

You are free to use any frameworks, databases, caching mechanisms and
messaging brokers to develop a solution.

### Service 1: Product service
- RESTful API for products with create, delete, edit, list and get by
identifier actions
- - product information should not return reviews, only average
product rating
- RESTful API for reviews with create, delete and edit actions
- Endpoints to show product reviews
- Service should notify review service when new review is added,
modified or deleted

### Service 2: Review processing service
- Service receives events from product service
- Each time review is received, it calculates average rating and stores it
into persistent storage
- Running in 2 separate instances
- - design must be able to handle more than 2 instances
- Service must be able to process multiple events concurrently

Products, product reviews and average product ratings should be cached.

### Product structure
- name
- description
- price
- list of reviews
- average rating (does not have to be directly a part of product)

### Review structure
- first name
- last name
- review text
- rating (1 - 5)

## Prerequisities

- Node.js (imlemented and tested with version 20.12.2)
- Nest.js (imlemented and tested with version 10.3.2)
- Docker (imlemented and tested with version 24.0.5)
- Docker Compose (imlemented and tested with version 1.25.0)

## Installation

```bash
$ npm install
```

## Prepare local environment

```bash
# initialize docker images/containers
$ docker-compose up -d
```

## Running the app (docker/docker-compose)

To run all dependencies (PostgreSQL, Redis, RabbitMQ), build dockers for both services and rum them (review-service in two instances)
use the command below.

```bash
# initialize docker images/containers
$ docker-compose up -d --scale review-service=2
```

## Running the app (local)

```bash
# development
$ npm run start
$ npm run start review-service

# watch mode
$ npm run start:dev
$ npm run start:dev review-service

# production mode
$ npm run start:prod
$ npm run start:prod review-service
```

## Test

```bash
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Swagger

The project uses/generates `Swagger` in development mode (`NODE_ENV=development`). `Swagger` is generated by `product-service`
and you can access it on this URL:
- http://localhost:3000/swagger

## Possible improvements

### Docker

The project uses `Docker` and `Docker Compose`. Used version are little outdated and it might be good idea to update those versions.

### Logging

Current version is logging to console only without logs persistence. On the other hand, it is just about configuration.
The project uses `Pino Logger` and it is possible to set any of supported streams (rotation files, sentry, etc.).

### Data Storage Module

I am used to (for historicall reasons) to have data (Entities, Repositories and Services) in one module with Controllers.
This project is implemented in this way, but it means some modules includes/injects at least Entity definition from another
module.

One shared module/library `data-storage`, which contains all Entities and theirs Repositories (for entities manipulation)
could be better solution. This module could be shared between all modules/micorservices which needs data manipulation.

### Message/Event handling

The project uses `RabbitMQ` for interprocess communication. Current implementation has just simple message/event delivery.
It might be good idea to set queue as durable, persistent and require consumer acknowledge (currently turned off) to
make message/event delivering more robust.

### Error Handling

The projects handles most of possible errors and edge cases, but not all of them. For example, database errors should
be translated to HTTP errors for production use.

### TODOs

The code contains some `TODOs`. They are ussually for reviewers to see what might be possible or what was considered,
but not implemented. Some `TODOs` can be about better error or data handling.

### Tests

The code and project are prepared for `unit tests` and `e2e test`, but in fact there are no real tests yet. Tests
should be implemented before production use.
